---
title: "Who do we think we are?"
knit: (function(input_file, encoding) {
  out_dir <- 'docs';
  rmarkdown::render(input_file,
 encoding=encoding,
 output_file=file.path(dirname(input_file), out_dir, 'index.html'))})
author: "Kelly Tall"
date: "19/10/2020"


output: 
        html_document:
                df_print: paged  
                toc: true
                toc_float: true     
                fig_caption: true 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(lubridate)
library(tidyverse)
library(DataExplorer)
library(plotly)
library(scales)
library(GGally)
library(ggraph)
library(tidygraph)

colours <- c("#2d4059", "#ea5455")

coloursGender <- c("sienna3", "turquoise4")

custom_theme <-  theme(
                        panel.grid.major.x = element_line(colour = "lightgrey", size=0.25),
                        # panel.background = element_rect(fill=("#e5e5e5")),
                        panel.background = element_blank(),
                        strip.background = element_blank(),
                        axis.ticks = element_line(colour = "lightgrey", size = 0.25),
                        # axis.line.x = element_line(colour = "lightgrey", size=0.25),
                        axis.line.x = element_blank())


# all data matched together- all updated as of 8th September

allData <- read_csv("allData.csv") %>% 
  mutate(state = factor(state, levels = c("NSW", "VIC", "QLD", "SA", "TAS", "WA", "ACT", "NT", "Other"))) %>% 
        mutate(awardComb = factor(awardComb, levels = c("ADK", "AC", "AO", "AM", "OAM"))) %>% 
  mutate(division = factor(division, levels = c("G", "M", "HG", "HM", "HP"))) %>% 
  ungroup()


anon_num <- allData %>% 
  filter(name=="Anonymous" | is.na(awardComb) | fullName =="Anonymous")


anon_numWP <- anon_num %>% 
  filter(wikipediaPage =="Yes")

        

##reoving anon recipients
allDataAnonRemoved <- read_csv("allDataAnonRemoved.csv") %>% 
  mutate(state = factor(state, levels = c("NSW", "VIC", "QLD", "SA", "TAS", "WA", "ACT", "NT", "Other"))) %>% 
        mutate(awardComb = factor(awardComb, levels = c("ADK", "AC", "AO", "AM", "OAM"))) %>% 
    mutate(division = factor(division, levels = c("G", "M", "HG", "HM", "HP"))) %>% 
  ungroup()


multipleHonoursList <- allDataAnonRemoved %>% 
  group_by(name) %>% 
  add_tally() %>% 
  filter(n>1) %>% 
  ungroup()
  

multipleHonoursListIndividials <- allDataAnonRemoved %>% 
  group_by(name) %>% 
  tally() %>% 
  filter(n>1) %>% 
  ungroup()
  



##fxing up naming issues and flattening ultiple awards to one record where earliest award date is used as honoursdate and highest level is award level
recipient <- read_csv("recipient.csv") %>% 
  ungroup() %>% 
  mutate(state = factor(state, levels = c("NSW", "VIC", "QLD", "SA", "TAS", "WA", "ACT", "NT", "Other"))) %>% 
        mutate(awardComb = factor(awardComb, levels = c("ADK", "AC", "AO", "AM", "OAM"))) %>% 
    mutate(division = factor(division, levels = c("G", "M", "HG", "HM", "HP"))) %>% 
  ungroup()



# all recipients with WP page

wikipedia <- read_csv("wikipedia.csv") %>% 
  mutate(state = factor(state, levels = c("NSW", "VIC", "QLD", "SA", "TAS", "WA", "ACT", "NT", "Other"))) %>% 
        mutate(awardComb = factor(awardComb, levels = c("ADK", "AC", "AO", "AM", "OAM"))) %>% 
    mutate(division = factor(division, levels = c("G", "M", "HG", "HM", "HP"))) %>% 
  ungroup()
        

```

### Research Questions

1. Does the Order of Australia honours list follow Wikipedia articles or do Wikipedia articles follow the honours?

2. Are there differences in this trend by gender?

3. Are there differences in this trend for different honours categories/levels?

4. Are there differences in this trend by state / location?

#### Background to Australian Honours System

The Order of Australia honours system was established in 1975, and has the following levels:

1. Dame/Knight(ADK) (1976-1983 and 2014-2015 only)
3. Companion (AC)
4. Officer (AO)
5. Member (AM)
6. Medal (OAM)

More information about the Order of Australia can be found here: https://en.wikipedia.org/wiki/Order_of_Australia.

Awards are issued with the following divisions:

1. General (G): awarded to Australian Citizens 
2. Military (M): warded to Australian Military
3. Honourary: General (HG) and Military (HM) awards can also be issued to non-citizens as honourary awards. A new distinction was created recently to honour permanent-residents. These used to be indicated as "HG", but are now indicated by "HP".

People can receive multiple Order of Australia honours in their lifetime. People can have their awards terminated by the Council, or return or refuse their awards.  Some awards are issued or recorded as anonymous on the honours Database.

### Data used in analysis


The data used in this analysis is based on:

1. <b>The Order of Australia list</b> that is maintained by the office of Prime Minister and Cabinet and found here: https://honours.pmc.gov.au/honours/search

2. <b>Wikipedia articles</b> linked to Order of Australia recipients and their creation date

### Dataset characteristics



#### 1. Anonymous Awards

Of the `r nrow(allData)` honours issued since 1975, there are `r nrow(anon_num)` that are listed as being issued to an "anonymous" recipient. The reasons why an honour is listed as anonymous could be as follows; 
* The recipient has requested anonynmity
* Their honour has been withdrawn by the council
* the recipient has refused, or returned their honour

Records from the PMO dataset that are listed as anonymous or teminated awards are imcomplete. Anonymous awards have only been if there has been an honour date, and a wikipedia page and a page creation date. If the record is missing the Honours date, they have been excluded from the dataset. 


#### 2. Multiple Awards

Of these `r nrow(allData)` records, there are `r nrow(multipleHonoursListIndividials)` individuals who have received more than one honour, and these acocunt for `r nrow(recipient)` individual honours. In order to account for multiple honour dates connecting to one wikipedia article and page creation date we have used the date of the <i>earliest award</i>. When referring to the individuals honour level, we use the most <i>recent honour</i>. 

For example, Angus Houston has received four honours. His earliest honour was an AM in 1990, and his most recent was a Knighthood in 2015. His wikipedia page was created in 2005. The table below illustrates his records extracted from the data set that contains all honours records.

```{r angusMultiple, eval=TRUE, echo=FALSE, fig.width=1}

angusExample <- allDataAnonRemoved %>% 
  select(name, awardComb, honoursDate, WPDate) %>% 
  filter(name == "Angus Houston")
  

angusExample
```

The table below illustrates his record extracted from the data set based on individual recipients. It shows that his honour level refers to his most recent honour in 2015 and his first award date refers to the first honour he received in 1990. 


```{r angusSingle, eval=TRUE, echo=FALSE, fig.width=1}

angusExample2 <- wikipedia %>% 
  filter(name == "Angus Houston") %>% 
  select(name, awardComb, firstAwardDate, WPDate) 
  
angusExample2

```

<!-- To make it clear for the reader and what data set we are using, refer to the chart footer. "All Honours" refers to <i>honours</i> issued, noting that an individual can hold multiple honours.  "All Recipients" refers to the <i>individuals or people</i> receiving awards and is usually used when looking at connections to wikipedia. -->


#### 3. Award Divisions 

As outlined above, honours are issued with different divisions, and the breakdown is displayed below

```{r eval=TRUE, echo=FALSE}

division <- recipient %>% 
  select(division) %>% 
  group_by(division) %>% 
  tally()
division

divisionNA <- recipient %>% 
  select(division) %>% 
  filter(is.na(division)) 
  

```

The HG and HM division is only held by 389 recipients, but some of them we can assume would have a wikipedia page whether they have an order of Australia or not. For example, Jacques Cousteau, Jerry Lewis, or Mother Theresa are all honorary recipients of an Order of Australia. There are some people though who have received honary awards whose "emminence" is linked to Australia, such as Jill Kerr, Joern Utzon and Googie Withers, and who also have a wikipedia article. Because of this, all of the honourary records have been left in the data set.

Please note there are `r nrow(divisionNA)` honours issued without a Division recorded on the PMO database. 




#### 3. Date calculations

The Australian Honors system began in 1975, and wikipedia was established on 15 January 2001. In order to calclate the time difference bewteen the award date and the wikipedia creation date, any award issued before 15 Jan 2001, has a "start date" of 15 January 2001. The table below shows the recipients first honour date (firstAwardDate), the date the time difference is calculted on (newAwardDate), the date their wikipedia entry was created, and the difference in time from honour to page creation. 

<b>A.D Hope</b> received their award in 1981. The earliest a wikpedia page could be created for them is 2001, and their page was created in 2004, so the difference is three years. Looking further down <b>Aaron Kierney</b> had a page created for them in 2012, and they received their honours in 2020. The time difference is -8, meaning their page was created 8 years <i>before</i> they received their honours. 

```{r eval=TRUE, echo=FALSE}

dateCalcs <- wikipedia %>% 
  select(name, firstAwardDate, newAwardDate, WPDate, yearDiff) %>% 
        head()

dateCalcs
```

### Addressing the research Questions 


##### Number of awards versus number of pages

Of the `r nrow(recipient)` recipients who have an Order of Australia, just over 11% also have a wikipedia page.



```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

propAll <- recipient %>% 
        select(wikipediaPage) %>% 
        add_tally() %>% 
        rename(total =n) %>% 
        group_by(wikipediaPage, total) %>% 
        tally() %>% 
        mutate(prop = n/total)

prop1 <-  ggplot(propAll, aes(wikipediaPage, prop, fill=wikipediaPage,
                              text = paste(percent(prop)))) +
  geom_col()+
   labs(title="Proportion of Honours recipients who have a wikipedia page",
       x="Have wikipedia Page", y="Proportion of honour recipients") +
  scale_fill_manual(values=colours)+
  scale_y_continuous(labels = percent)+
  custom_theme
  
t <- list(
        
  family = "Helvetica",
  size = 14)

m <- list(
  l = 50,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)

chart1 <- ggplotly(prop1, tooltip = 'text') 



chart1 %>% 
  layout(font=t, 
         annotations = 
           list(x = 1, y = -0.1, text = "All Recipients n=41,337", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-5,
                font=list(size=10)),
         autosize=F,
         width=800, 
         height=500,
         margin=m)



```
<div style="margin-bottom:40px;">
</div>

#### Proportions by Award Level 

The proportion of those with and without pages is different depending on the honour level. The higher the honour, the more likely a recipient is to have a wikipedia page. All 19 Knights and Dames have a wikipedia page - <i>including The Duke of Edinburgh and The Prince of Wales </i>, and 85% of those who are an AC have a wikipedia page. The lower order reciptients have significantly fewer pages. 

An AC is required to demonstrate eminence in their field, and an AO "distinguished service". AMs are issued to those demonstarting "exceptional service" to a field, activity or group, and an OAM is gven to those who demonstarte "service worthy or a particular recognition". A wikipedia page can be created for someone who is "worthy of notice". Assuming most AO's are notable in some way, there are 1955 currently without wikipedia pages. 

From this we can see that the current highest order (AC) is well documented on wikipedia, but the lower orders, particularly the AO level, has potential for more representation on wikipedia. 


<div style="margin-bottom:20px;">
</div>

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

pagePropAward <- recipient %>% 
        select(awardComb, wikipediaPage) %>% 
        group_by(awardComb) %>% 
        add_tally(name="total") %>% 
        ungroup() %>% 
        group_by(awardComb, wikipediaPage, total) %>% 
        tally(name="subtotal") %>% 
        mutate(prop=subtotal/total)

pagePropAwardChart <- ggplot(pagePropAward, aes(awardComb, prop, fill=wikipediaPage,
                                                text = paste(percent(prop)))) +
        geom_bar(position="fill", stat="identity") +
        custom_theme+
        labs(title="Proportion of award recipients that have a wikipedia article page by highest award received", 
             x="Order of Australia (membership levels)", y="Proportion of recipients") +
        scale_y_continuous(labels = percent)+
        scale_fill_manual(values=colours)


t <- list(
  family = "Helvetica",
  size = 14)

ggplotly(pagePropAwardChart, tooltip = 'text') %>% 
  layout(font=t, 
         annotations = 
           list(x = 1, y = -0.2, text = "All Recipients n=41,337",
                showarrow = F, xref='paper', yref='paper',
                xanchor='right', yanchor='auto', xshift=1, yshift=-5,
                font=list(size=10)),
         autosize=F,
         width=800, 
         height=500,
         margin=m)

```

<div style="margin-bottom:40px;">
</div>

#### Proportions by Gender

Overall, just under 30% of all Order of Australia honours have been issues to women. The split is shown in the table below. There are thirty three recipients where no gender is recorded.


```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

genderSplit <- recipient %>% 
  ungroup() %>% 
  select(gender) %>% 
  group_by(gender) %>% 
  tally(name="number")

genderSplit

genderUndefined <- recipient %>% 
  select(gender) %>%
  filter(gender=="U")
```



Although women are under represented on the honours list, the rate of page creation overall for men and women is propportionally similar, with women at just under 10% and men at 11%. While the base number of women receiving awards is lower, the proportion of pages created for them in wikipedia is roughly the same. 

<i>(Note: The below chart excludes the `r nrow(genderUndefined)` recipients who have no gender allocated to the data set.)</i>

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

pagePropGender <- recipient %>% 
        select(gender, wikipediaPage) %>% 
  filter(gender !="U") %>% 
        group_by(gender) %>% 
        add_tally(name="total") %>% 
        group_by(wikipediaPage, gender) %>% 
        add_tally(name="subtotal") %>% 
        mutate(prop=subtotal/total) %>% 
        group_by(gender, wikipediaPage, prop) %>% 
        summarise()
        

pagePropGenderChart <- ggplot(pagePropGender, aes(gender, prop, fill=wikipediaPage,
                                                  text = paste(percent(prop)))) +
        geom_bar(position="fill", stat="identity") +
        custom_theme+
        labs(title="Proportion of award recipients that have a wikipedia article page by Gender", 
             x="Order of Australia (membership levels)", y="Proportion of recipients") +
        scale_y_continuous(labels = percent)+
        scale_fill_manual(values=colours)

t <- list(
  family = "Helvetica",
  size = 14)



ggplotly(pagePropGenderChart, tooltip="text") %>% 
  layout(font=t, 
         annotations = 
           list(x = 1, y = -0.25, text = "All Recipients with allocated Gender n=41,309", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)


```

<div style="margin-bottom:40px;">
</div>


Looking at the proprtion of pages created by honours level though, reveals that women receiving some honours have a higher propotion of pages created for them, compared to men. This possibly indicates that different initiatives that encourage page creation for women, are working. 

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

pagePropGenderAward <- recipient %>% 
  ungroup() %>% 
  filter(gender!="U") %>% 
              select(gender, awardComb, wikipediaPage) %>% 
        group_by(gender, awardComb) %>% 
        add_tally(name="total") %>% 
  
        group_by(gender, awardComb, wikipediaPage) %>% 
        add_tally(name="subtotal") %>% 
        mutate(prop=subtotal/total) %>% 
        group_by(gender, awardComb, wikipediaPage, prop) %>% 
        summarise()



pagePropGenderAwardChart <- ggplot(pagePropGenderAward, aes(gender, prop, fill=wikipediaPage,text = paste(percent(prop)))) +
        geom_bar(position="fill", stat="identity") +
        custom_theme+
        labs(title="Proportion of award recipients that have a wikipedia article page by Gender", 
             x="Order of Australia (membership levels)", y="Proportion of recipients") +

        scale_y_continuous(labels = percent)+
        scale_fill_manual(values=colours)+
        facet_wrap(~awardComb)

m <- list(
  l = 75,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)        



t <- list(
  family = "Helvetica",
  size = 14)

# str(test[['x']][['layout']][['annotations']]) 



test <- ggplotly(pagePropGenderAwardChart, tooltip="text")

test[['x']][['layout']][['annotations']][[2]][['x']] <- -.09
test[['x']][['layout']][['annotations']][[1]][['y']] <- -.1

test %>% layout(font=t, 
         annotations = 
           list(x = 1, y = -0.25, text = "All Recipients with allocated Gender n=41,309", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)



```

<div style="margin-bottom:40px;">
</div>

The below charts shows the difference between the proportion of pages created for men and women, with the line showing the total proportion or average for each honours level of those with a page created. Anything above the line is "above average". It shows how AC and AO female recipients have an above average chance to have a page created for them. compred to men.
 
 
```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

pageAverageTotal <- recipient %>% 
        ungroup() %>% 
        filter(gender!="U") %>% 
        select(gender, awardComb, wikipediaPage) %>% 
        group_by(awardComb) %>% 
        add_tally(name = "totalHonour") %>% 
        group_by(awardComb, wikipediaPage) %>% 
        add_tally(name = "totalWP") %>% 
        mutate(totalProp=totalWP/totalHonour) %>% 
        group_by(awardComb,gender) %>% 
                add_tally(name="totalGender") %>% 
                group_by(awardComb, wikipediaPage, gender) %>% 
                add_tally(name="totalWPGender") %>% 
                mutate(totalWPProp = totalWPGender/totalGender) %>% 
        group_by(awardComb,gender, wikipediaPage, totalProp, totalWPProp) %>% 
        summarise(n = n()) %>% 
        filter(wikipediaPage=="Yes")
        
        
 
pageAverageGenderAwardChart <- ggplot(pageAverageTotal, aes(gender, totalWPProp, fill=gender, text = paste(percent(totalWPProp)))) +
        geom_col() +
        geom_hline(aes(yintercept = totalProp))+
        custom_theme+
        labs(title="Proportion of award recipients that have a wikipedia article page by Gender", subtitle = "Line represents total proportion to highlight differences",
             x="Order of Australia (membership levels)", y="Proportion of recipients") +

        scale_y_continuous(labels = percent)+
        scale_fill_manual(values=coloursGender)+
        facet_wrap(~awardComb) 

m <- list(
  l = 75,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   

t <- list(
  family = "Helvetica",
  size = 14)

chart4 <- ggplotly(pageAverageGenderAwardChart, tooltip="text")

chart4[['x']][['layout']][['annotations']][[2]][['x']] <- -.09
chart4[['x']][['layout']][['annotations']][[1]][['y']] <- -.1

chart4 %>% layout(font=t, 
         annotations = 
           list(x = 1, y = -0.25, text = "All Recipients with allocated Gender n=41,309", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)




```


The below chart shows the biggest difference in <i>proportions</i> of pages is with AM.

(How to understand this chart: the proportion of AC honours recipients to have a wikipedia page is 85%. The proportion of women who hve an AC and a wikipedia page is 95%. This is a 12.5% difference between the two percentages / propotions of total AC holders wth wikipedia pages and women AC holders with wikipedia pages)

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

percdiff<- pageAverageTotal %>% 
        ungroup() %>% 
        group_by(awardComb) %>% 
        # arrange(awardComb, gender) %>% 
        mutate(totalDiff = (((totalWPProp*100)-(totalProp*100))/(totalProp*100))) %>% 
        mutate(genderDiff = (lag(totalWPProp)-(totalWPProp))/totalWPProp)
                             
                             
percdiffChart <- ggplot(percdiff, aes(gender, totalDiff, fill=gender, text=percent(totalDiff))) +
        geom_col() +
        geom_hline(aes(yintercept=0), colour = "lightgrey")+
        custom_theme+
        labs(title="% Difference of men and women compared to honours level average", subtitle = "Line represents total proportion to highlight differences",
             x="Order of Australia (membership levels)", y="Proportion of recipients") +

        scale_y_continuous(labels = percent)+
        scale_fill_manual(values=coloursGender)+
        facet_wrap(~awardComb) 

m <- list(
  l = 75,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   

t <- list(
  family = "Helvetica",
  size = 14)
    
chart5 <- ggplotly(percdiffChart, tooltip="text")
chart5[['x']][['layout']][['annotations']][[2]][['x']] <- -.09
chart5[['x']][['layout']][['annotations']][[1]][['y']] <- -.1


chart5 %>% layout(font=t, 
         annotations = 
           list(x = 1, y = -0.25, text = "All Recipients with allocated Gender n=41,309", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)

```

Comparing men versus women at each honours level, shows us that proportionally the biggest difference is with AM's, where there is a differnce of 28%

(How to understand this chart: the proportion of female AC honours recipients to have a wikipedia page is 95%, and the proportion of males who have an AC who have a wikipedia page is 82%. This gives us a proportional difference of 15%). 


```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

percdiffChartBYAWARD <- ggplot(percdiff, aes(awardComb, genderDiff, text=percent(genderDiff))) +
        geom_col(fill="#2d4059") +
        geom_hline(aes(yintercept=0), colour = "lightgrey")+
        custom_theme+
        labs(title="% Difference from women versus men WITHIN honour level",
             x="% difference in Order of Australia (membership levels)", y="Proportion of recipients") +

        scale_y_continuous(labels = percent)+
        scale_fill_manual(values=colours)
    
m <- list(
  l = 75,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   

t <- list(
  family = "Helvetica",
  size = 14)

ggplotly(percdiffChartBYAWARD, tooltip="text") %>% 
        layout(font=t, 
         annotations = 
           list(x = 1, y = -0.25, text = "All Recipients with allocated Gender n=41,309", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)


```

<div style="margin-bottom:40px;">
</div>





#### State and proportions of awards

There is slightly more ACT recipients who have a wikipedia page compared to other states (higher rate of politicians and public servants who receievd awards?). The higher proportion of "other" relates to the honourary award recipients referred to above, who are internationally eminent and would be more likely to ahve a WP page whether they have an Australian honour or not.    .   

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

pagePropState <- recipient %>% 
        select(state, wikipediaPage) %>% 
        group_by(state) %>% 
        add_tally(name="total") %>% 
        group_by(state, wikipediaPage) %>% 
        add_tally(name="subtotal") %>% 
        mutate(prop=subtotal/total) %>% 
        group_by(state, wikipediaPage, prop) %>% 
        summarise(n=n())



pagePropStateChart <- ggplot(pagePropState, aes(state, prop, fill=wikipediaPage, text=percent(prop))) +
        geom_bar(position="fill", stat="identity") +
        custom_theme+
        labs(title="Proportion of award recipients that have a wikipedia article page by state", 
             x="Order of Australia (membership levels)", y="Proportion of recipients") +
        scale_y_continuous(labels = percent)+
        scale_fill_manual(values=colours)

m <- list(
  l = 75,
  r = 200,
  b = 100,
  t = 100,
  pad = 4
)   

t <- list(
  family = "Helvetica",
  size = 14)

ggplotly(pagePropStateChart, tooltip="text") %>% 
  layout(font=t, 
         annotations = 
           list(x = 1, y = -0.1, text = "All Recipients n=41,337", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
         autosize=F,
         width=800, 
         height=500,
         margin=m) 



# pagePropStateChartAward <- ggplot(pagePropStateAward, aes(awardComb, prop, fill=wikipediaPage, text=percent(prop))) +
#         geom_bar(position="fill", stat="identity") +
#         custom_theme+
#         labs(title="Proportion of award recipients that have a wikipedia article page by state", 
#              x="Order of Australia (membership levels)", y="Proportion of recipients") +
#         scale_y_continuous(labels = percent)+
#         scale_fill_manual(values=colours)+
#         facet_wrap(~state)
```

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}


pagePropStateAward <- recipient %>% 
        select(state, wikipediaPage, awardComb) %>% 
        group_by(state, awardComb) %>% 
        add_tally(name="total") %>% 
        group_by(state, wikipediaPage, awardComb) %>% 
        add_tally(name="subtotal") %>% 
        mutate(prop=subtotal/total) %>% 
        group_by(state, wikipediaPage, awardComb, prop) %>% 
        summarise(n=n()) 



pagePropStateChartAward <- ggplot(pagePropStateAward, aes(awardComb, prop, fill=wikipediaPage, text=percent(prop))) +
        geom_bar(position="fill", stat="identity") +
        custom_theme+
        labs(title="Proportion of award recipients with wikipedia page by honours level split by state", 
             x="Order of Australia (membership levels)", y="Proportion of recipients") +
        scale_y_continuous(labels = percent)+
        scale_fill_manual(values=colours)+
        facet_wrap(~state)

m <- list(
  l = 75,
  r = 200,
  b = 100,
  t = 100,
  pad = 4
)   

t <- list(
  family = "Helvetica",
  size = 14)

chart6 <- ggplotly(pagePropStateChartAward, tooltip="text")

chart6[['x']][['layout']][['annotations']][[2]][['x']] <- -.09
chart6[['x']][['layout']][['annotations']][[1]][['y']] <- -.1

chart6 %>% layout(font=t, 
         annotations = 
           list(x = 1, y = -0.25, text = "All Recipients n=41,342", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)

```

The below chart shows all recipeints with a wikipedia page (exclusing Knights and Dames does to low sample size and all from "Other" location). The line represents the national average for each award level, showing states with above or below average performance.

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

pageAverageTotalState <- recipient %>% 
        ungroup() %>%
        select(state, awardComb, wikipediaPage) %>% 
        filter(state!="Other") %>% 
        filter(awardComb!="ADK") %>% 
        group_by(awardComb) %>% 
        add_tally(name = "totalHonour") %>% 
        group_by(awardComb, wikipediaPage) %>% 
        add_tally(name = "totalWP") %>% 
        mutate(totalProp=totalWP/totalHonour) %>% 
        group_by(awardComb,state) %>% 
                add_tally(name="totalState") %>% 
                group_by(awardComb, wikipediaPage, state) %>% 
                add_tally(name="totalWPState") %>% 
                mutate(totalWPProp = totalWPState/totalState) %>% 
        group_by(awardComb,state, wikipediaPage, totalProp, totalWPProp) %>% 
        filter(wikipediaPage=="Yes") %>% 
        summarise(n = n()) %>% 
        mutate(propComparison = (totalWPProp - totalProp)/totalWPProp)
        
        

   
pageAverageTotalStateChart <- ggplot(pageAverageTotalState, aes(state,totalWPProp, text = paste(percent(totalWPProp)))) +
        geom_col(fill="#2d4059") +
        geom_hline(aes(yintercept = totalProp))+
        custom_theme+
        labs(title="Proportion of award recipients that have a wikipedia article page by state", subtitle = "Line represents total proportion to highlight differences",
             x="Home state of honour recipient ", y="Proportion of recipients") +

        scale_y_continuous(labels = percent)+
        scale_fill_manual(values=coloursGender)+
        facet_wrap(~awardComb) 

m <- list(
  l = 75,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   

t <- list(
  family = "Helvetica",
  size = 14)

chart8 <- ggplotly(pageAverageTotalStateChart, tooltip="text")

chart8[['x']][['layout']][['annotations']][[2]][['x']] <- -.09
chart8[['x']][['layout']][['annotations']][[1]][['y']] <- -.1

chart8 %>% layout(font=t, 
         annotations = 
           list(x = 1, y = -0.25, text = "Recipients with WP page excluding ADK & Other location n=4053", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)     
        
```

The below charts shows the proportional difference between those with a wikipedia page and an honour level, compared to the national average. There is no evident pattern of one state outperforming another at each level. 

(Could this be there is no "state pride" in creating wikipedia pages for local recipients? Rather people create based on their intersts in theme of politics or sport or science, rather than "home grown heroes"?)


```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

pageAverageTotalStateChartProp <- ggplot(pageAverageTotalState, aes(state,propComparison, text = paste(percent(propComparison)))) +
        geom_col(fill="#2d4059") +
        # geom_hline(aes(yintercept = totalProp))+
        custom_theme+
        labs(title="% difference between national and state level for each honour level", subtitle = "Line represents total proportion to highlight differences",
             x="Home state of honour recipient ", y="Proportion of recipients") +

        scale_y_continuous(labels = percent)+
        scale_fill_manual(values=coloursGender)+
        facet_wrap(~awardComb) 

m <- list(
  l = 75,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   

t <- list(
  family = "Helvetica",
  size = 14)

chart9 <- ggplotly(pageAverageTotalStateChartProp, tooltip="text")

chart9[['x']][['layout']][['annotations']][[2]][['x']] <- -.09
chart9[['x']][['layout']][['annotations']][[1]][['y']] <- -.1

chart9 %>% layout(font=t, 
         annotations = 
           list(x = 1, y = -0.25, text = "Recipients with WP page excluding ADK & Other location n=4053", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)     


```


#### Summary - Number of awards versus number of pages

* Overall, 11% of honour recipients have a wikipedia page. 
* The higher the honours level, the more likely a page has been created for the recipient, reflecting the notability of the person, and the notability requirement for having a wikipedia article.
* There is still potential for more pages to be created at the AO level, which currenlty is the second highest honour in the system, yet more than half of the recipients do not have a wikipedia article. 
* Women  are under-represented in the hoours list, but the proportion of wikipedia pages is quite strong, with more pages created for women who have receievd an AC or an AO, than for me who have also receieved the same honour. This may be an outcome of different initiatves that promote respresentation of women on wikiepdia.   
* Looking at proportional differences shows us the largest difference between women and men who have a wikipedia page is at the AM level, where there is a 28% difference. 
* There are no evident patterns looking at state and those who have a page compered to the national average. No state is "outperforming" another for the number of oages created. Is this  because people create pages based on interest in a field or topic rather than the home location of the honours recipient?

#### Differences between honours date and page creation date

This section examines the rate of page creation, and the difference between the time it takes for a person to receive an Honour, and the time their page is created. Does it lag or lead?

The table below shows the number of recipients who received their honour before or on/after the launch of Wikipedia on 15 January 2001. Close to 60% of the honour recipients received their honour on or after the start of wikipedia. PreVPost is the raw numbers of people who receivd an award before or on/after the start of Wikipedia, and preVPostProp is the proportion.



```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}


prePost <- recipient %>% 
        add_tally(name = "total") %>% 
  mutate(prePost = case_when(firstAwardDate<"2001-01-15" ~ "Pre WP",
                                   firstAwardDate>="2001-01-15" ~ "Post WP")) %>% 
mutate(prePost = factor(prePost, levels = c("Pre WP", "Post WP"))) %>% 
  select(prePost, total) %>% 
  group_by(prePost, total) %>% 
  tally(name= "preVPost") %>% 
        mutate(preVPostProp = preVPost/total )


prePost

```

<div style="margin-bottom:40px;">
</div>




Looking at those who have a wikipedia page and broken down between those who receievd their honour before or after wikipedia started. The propotion of pages have been created at a similar rate of between 10-11%. At this level there doesn't appear to be any "recency bias" of a larger proportion of pages created honour recipents who received their award aftre the strat of Wikipedia. 

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
 
prePostProp <- recipient %>% 
    ungroup() %>% 
  mutate(prePost = case_when(firstAwardDate<"2001-01-15" ~ "Pre WP",
                                   firstAwardDate>="2001-01-15" ~ "Post WP")) %>% 
        mutate(prePost = factor(prePost, levels = c("Pre WP", "Post WP"))) %>% 
  select(prePost, wikipediaPage) %>% 
        group_by(prePost) %>% 
        add_tally(name="prePostTotal") %>% 
  group_by(prePost, wikipediaPage) %>% 
        add_tally(name = "prePostWPTotal") %>% 
        mutate(prop = prePostWPTotal / prePostTotal) %>% 
        group_by(prePost, wikipediaPage, prop) %>% 
        summarise(n())



prePostChart <- ggplot(prePostProp, aes(prePost, prop, fill=wikipediaPage, text=percent(prop))) +
        geom_bar(position="fill", stat="identity") +
        custom_theme+
        labs(title="Proportion of honours receievd pre/post WP, that have a wikipedia article", 
             x="Pre and Post 15th Jan 2001", y="Proportion of recipients") +
        scale_y_continuous(labels = percent)+
        scale_fill_manual(values=colours)


m <- list(
  l = 75,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   
t <- list(
  family = "Helvetica",
  size = 14)

ggplotly(prePostChart, tooltip="text") %>% 
  layout(font=t, 
         annotations = 
           list(x = 1, y = -0.1, text = "All Recipients n=41,337", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
         autosize=F,
         width=800, 
         height=500,
         margin=m)  






```

#### Page or Award - what comes first?

The below chart shows the distrubtion of wikipedia page creation over time. The bars left of zero represent all whose page was created <i>before</i> they received an award. All those to the right of zero represent all whose page was created <i>after</i> they receievd an award

The distribution of the chart below shows based on all recipeints, there are more pages created after someone has received an award, than before. 

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

prePostAward <- wikipedia %>% 
        select(yearDiff) %>%
        group_by(yearDiff) %>% 
        tally() 
  
        


yearDiffChart <-  ggplot(prePostAward, aes(yearDiff, n, text=paste('num:', n))) +
        geom_col(fill="#2d4059") +
  custom_theme +
        labs(title="Difference in time beween award and wikipedia page creation", 
             x="Years Difference ", y="Number of recipients")

m <- list(
  l = 75,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   



ggplotly(yearDiffChart, tooltip="text") %>% 
  layout(font=t, 
         annotations = 
           list(x = 1, y = -0.15, text = "All Recipients with wikipedia page n=4423", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
         autosize=F,
         width=800, 
         height=500,
         margin=m)     





```

This though may not be an accurate view, as we are including a large group who were awarded an honour before Wikipedia began. 

The below chart only shows those who receievd an honour on or after the start of wikpedia, and there is a skew towards pages being created before their honour is received. 

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

prePostAwardPrePostWP <- wikipedia %>% 
        select(firstAwardDate, wikipediaYear, yearDiff) %>% 
        mutate(prePost = case_when(firstAwardDate<"2001-01-15" ~ "Pre WP",
                                   firstAwardDate>="2001-01-15" ~ "Post WP")) %>% 
        filter(prePost=="Post WP") %>% 
        select(yearDiff, prePost) %>%
        group_by(prePost, yearDiff) %>% 
        tally() 
  

prePostAwardPrePostWPFilter <- wikipedia %>% 
        select(firstAwardDate, wikipediaYear, yearDiff) %>% 
        mutate(prePost = case_when(firstAwardDate<"2001-01-15" ~ "Pre WP",
                                   firstAwardDate>="2001-01-15" ~ "Post WP")) %>% 
        filter(prePost=="Pre WP") %>% 
        select(yearDiff, prePost) %>%
        group_by(prePost, yearDiff) %>% 
        tally() 
        


yearDiffPrePostChart <-  ggplot(prePostAwardPrePostWP, aes(yearDiff, n)) +
        geom_col(fill="#2d4059") +
  custom_theme +
        labs(title="Years Difference between honour and page (only those with award on or post 2001)", 
             x="Years Difference ", y="Number of recipients")


yearDiffPrePostChartFilter <-  ggplot(prePostAwardPrePostWPFilter, aes(yearDiff, n, text=paste('num:', n))) +
        geom_col(fill="#2d4059") +
  custom_theme 

m <- list(
  l = 75,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   

ggplotly(yearDiffPrePostChart, tooltip="text") %>% 
  layout(font=t, 
         annotations = 
           list(x = 1, y = -0.15, text = "All Recipients w. WP page receiving award post-wikipedia n=2528", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
         autosize=F,
         width=800, 
         height=500,
         margin=m)     


```


Focussing further on this group who received their honour on or after the start of wikipedia, there is a larger proportion (54%) who have their award before the page was created. 

```{r eval=TRUE, echo=FALSE}


prePostAwardSumExcOld <- wikipedia %>% 
        filter(firstAwardDate>"2001-01-15") %>% 
        select(name, timeDiff) %>%
        add_tally(name="total") %>% 
  mutate(beforeAfter = case_when(timeDiff >=0 ~ "on or after honours",
                                 timeDiff<0 ~ "before Honours")) %>%
              mutate(beforeAfter = factor(beforeAfter, levels = c("before Honours","on or after honours"))) %>%
  group_by(beforeAfter) %>% 
        filter(!is.na(beforeAfter)) %>% 
  add_tally(name="split") %>% 
        mutate(prop = split/total) %>% 
        group_by(beforeAfter, prop) %>% 
        tally()
  
prePostChart1ExcOld <- ggplot(prePostAwardSumExcOld, aes(beforeAfter, prop)) +
        geom_col(fill="#2d4059") +
  custom_theme +
        scale_y_continuous(labels = percent)+
           labs(title="Years Difference between honour and page (only those with award on or post 2001)", 
             x="Years Difference ", y="Number of recipients")

        

ggplotly(prePostChart1ExcOld, tooltip="prop") %>% 
  layout(font=t, 
         annotations = 
           list(x = 1, y = -0.1, text = "All Recipients with page, honour post WP n=2528", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10))) 
```

For those who received their award after the start of wikipedia, across most honour levels, the majority had their page created before they received their honour.


```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}


prePostAwardSumExcOldLevels <- wikipedia %>% 
        filter(firstAwardDate>"2001-01-15") %>% 
        select(name, timeDiff, awardComb) %>%
        add_tally(name="total") %>% 
  mutate(beforeAfter = case_when(timeDiff >=0 ~ "on or after honours",
                                 timeDiff<0 ~ "before Honours")) %>%
              mutate(beforeAfter = factor(beforeAfter, levels = c("before Honours","on or after honours"))) %>%
        ungroup() %>% 
        group_by(beforeAfter) %>% 
        add_tally(name="splitTotal") %>% 
        group_by(awardComb) %>% 
        add_tally(name="awardTotal") %>%
  group_by(awardComb, beforeAfter) %>% 
        filter(!is.na(beforeAfter)) %>% 
        add_tally(name="awardSplit") %>% 
        mutate(totalProp = splitTotal/total) %>% 
        mutate(awardProp = awardSplit/awardTotal) %>%
        group_by(awardComb, beforeAfter, awardProp) %>% 
        summarise(n())
       

          
  
prePostChart1ExcOldLevels <- ggplot(prePostAwardSumExcOldLevels, aes(beforeAfter, awardProp, text=percent(awardProp))) +
        geom_col(fill="#2d4059") +
  custom_theme +
        facet_wrap(~awardComb)+
        scale_y_continuous(labels = percent)+
        labs(title="Page created pre or post honour by honour level (all honours post WP)", 
             x="Years Difference ", y="Number of recipients")
m <- list(
  l = 75,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   
t <- list(
  family = "Helvetica",
  size = 14)


chart11 <- ggplotly(prePostChart1ExcOldLevels, tooltip="text") 
        
        
chart11[['x']][['layout']][['annotations']][[2]][['x']] <- -.09
chart11[['x']][['layout']][['annotations']][[1]][['y']] <- -.1



chart11 %>% layout(font=t, 
         annotations = 
           list(x = 1, y = -0.15, text = "All Recipients with page, honour post WP n=2528", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
         autosize=F,
         width=800, 
         height=500,
         margin=m)    
```


The below chart hows the perecentage difference in the proportion for those who had their page created before receiving their honours and those who 

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}


prePostprePostAwardSumExcOldLevelsDiff <- prePostAwardSumExcOldLevels %>% 
        # filter(awardComb!="ADK") %>% 
        group_by(awardComb) %>% 
        mutate(prePostDiff = (lead(awardProp)-awardProp)/awardProp)

prePostprePostAwardSumExcOldLevelsDiffChart <- ggplot(prePostprePostAwardSumExcOldLevelsDiff, aes(awardComb, prePostDiff, text=percent(prePostDiff))) +
        geom_col(fill="#2d4059") +
  custom_theme +
        scale_y_continuous(labels = percent)+
        labs(title="Difference preHonour v postHonour in wikipedia page creation (all honours post WP)", 
             x="Years Difference ", y="Number of recipients")


chart10 <- ggplotly(prePostprePostAwardSumExcOldLevelsDiffChart, tooltip="text") 
        
        
chart10[['x']][['layout']][['annotations']][[2]][['x']] <- -.09
chart10[['x']][['layout']][['annotations']][[1]][['y']] <- -.1

chart10 %>% layout(font=t, 
         annotations = 
           list(x = 1, y = -0.15, text = "All Recipients with page, honour post WP n=2528", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)     


```

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

prePostAwardYearGender <- wikipedia %>% 
        select(timeDiff, gender) %>%
        group_by(gender) %>% 
        filter(gender!="U") %>% 
               add_tally(name="total") %>%
  mutate(beforeAfter = case_when(timeDiff >=0 ~ "on or after honours",
                                 timeDiff<0 ~ "before Honours")) %>%
              mutate(beforeAfter = factor(beforeAfter, levels = c("before Honours","on or after honours"))) %>%
  group_by(beforeAfter, gender) %>% 
        filter(!is.na(beforeAfter)) %>% 
        add_tally(name="split") %>% 
        mutate(prop = split/total) %>% 
        group_by(beforeAfter, gender,prop) %>% 
        tally()
        
prePostAwardYearGenderChart <- ggplot(prePostAwardYearGender, aes(gender, prop, fill=gender, text=percent(prop))) +
        geom_bar(position="stack", stat="identity") +
        scale_fill_manual(values=coloursGender)+
        custom_theme+
        facet_wrap(~beforeAfter)+
        scale_y_continuous(labels = percent)+
        labs(title="Diff in gender preHonour v postHonour in wikipedia page creation (all honours post WP)", 
             x="Gender split by before / on or after honours", y="Proportion of recipients")

        
chart14 <- ggplotly(prePostAwardYearGenderChart, tooltip="text") 

chart14[['x']][['layout']][['annotations']][[2]][['x']] <- -.09
chart14[['x']][['layout']][['annotations']][[1]][['y']] <- -.1

chart14 %>% layout(font=t, 
         annotations = 
           list(x = 1, y = -0.2, text = "All Recipients with page, honour post WP n=2528", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)     


```

### Rate of Wikipedia page creation over time 

The below chart shows a cumulative total of wikipedia pages created for those who hold an Order of Australia over time. There is a significant jump in cumulative page creation around 2005, and another visible jump around 2011.


```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}


cumPageDiff <- wikipedia %>% 
       select(WPDate) %>% 
        group_by(WPDate) %>% 
        tally(name="total") %>% 
        mutate(cumPages = cumsum(total)) %>% 
        mutate(cumpagesDiff = total - first(total), 
               cumpagesDiffPercent = cumpagesDiff/ - first(total)*100)



cumPageChart <- ggplot(cumPageDiff, aes(WPDate, cumPages, group=1, text=paste(WPDate,":",cumPages))) +
       
        geom_line(colour="#2d4059") +
        # geom_smooth()+
        # scale_fill_manual(values=colours)+
        custom_theme+
        # scale_y_continuous(labels = percent)+
        labs(title="Daily cumulative page creation of honours recipients", 
             x="Date of Page creation", y="Number of pages")


m <- list(
  l = 80,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   

ggplotly(cumPageChart, tooltip="text") %>% 
layout(font=t, 
         annotations = 
           list(x = 1, y = -0.2, text = "All Recipients with page n=4423", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)     
```

In order to see the peaks and drops more clearly, pages have been aggregated to a year level. Using yearly numbers and adding in a trend line, we can see that 2005 and 2006 saw an above-average moment in page creation, and smaller ones in 2011, and 2014.  There has been though, a genera decline since the peak of page creation in 2005-2006.

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}


cumPageYearDiff <- wikipedia %>% 
       select(wikipediaYear) %>% 
        group_by(wikipediaYear) %>% 
        filter(!is.na(wikipediaYear)) %>% 
        tally(name="total") %>% 
        ungroup() %>% 
        mutate(cumPages = cumsum(total)) %>% 
        mutate(pagesDiffStart = total - first(total), 
               # cumpagesDiffPercent = cumpagesDiff/ first(total)*100,
               cumpagesDiffPercentYOY = (total- lag(total))/lag(total))

cumPageChartYear <- ggplot(cumPageYearDiff, aes(wikipediaYear, total, text=paste(wikipediaYear,": ", total), group=1)) +
        geom_smooth()+
         geom_line(colour="#2d4059", width=2) +
        # geom_smooth()+
        # scale_fill_manual(values=colours)+
        custom_theme+
        # scale_y_continuous(labels = percent)+
        labs(title="Yearly cumulative page creation with trend line", 
             x="Date of Page creation", y="Number of pages")

m <- list(
  l = 80,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   

ggplotly(cumPageChartYear, tooltip="text") %>% 
layout(font=t, 
         annotations = 
           list(x = 1, y = -0.2, text = "All Recipients with page n=4423", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)     

```

The chart below compares each year to the start year. Between 2001, and 2002 there was in increase in 22 pages, between 2001 and 2013 a difference of 124 etc. It shows how over time, there are fewer pages being created each year. (Please note that 2020 is an incomplete year in the data set).  

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

cumPageChartYearDiffStart <- ggplot(cumPageYearDiff, aes(wikipediaYear, pagesDiffStart, group=1, text=paste("2001 v",wikipediaYear,":", pagesDiffStart))) +
        custom_theme+
        labs(title="Pages created in year one versus consecutive years", 
             x="Date of Page creation", y="Difference in number of pages")+
        geom_col(fill="#2d4059")

m <- list(
  l = 80,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   

ggplotly(cumPageChartYearDiffStart, tooltip="text") %>% 
layout(font=t, 
         annotations = 
           list(x = 1, y = -0.2, text = "All Recipients with page n=4423", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)     
        
```

Looking at the percentage difference year on year in page creation, the last five years has seen a flattening of the creation of new pages of thsoe who have received an Australian Honours.  

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
cumPageChartYearDiffYOY <- ggplot(cumPageYearDiff, aes(wikipediaYear, cumpagesDiffPercentYOY, text=paste(wikipediaYear,":",percent (cumpagesDiffPercentYOY)))) +
        geom_col(fill="#2d4059")+
        custom_theme+
        labs(title="Page creation difference Year on Year", 
             x="Date of Page creation", y="% Difference in number of pages")+
        scale_y_continuous(labels = percent)
        

ggplotly(cumPageChartYearDiffYOY, tooltip="text") %>% 
layout(font=t, 
         annotations = 
           list(x = 1, y = -0.2, text = "All Recipients with page n=4423", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)     
        




```

There is potential that there are less pages being created for those with an honours because there are less people receiving honours over time. The chart below shows total honours issued since 1975, and apart from a few periods where the rate dips below the average, there is an increae in the nuber of honours being granted every year. 


```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

awardRate <- allDataAnonRemoved %>% 
        select(honoursYear) %>% 
        filter(!is.na(honoursYear)) %>% 
        group_by(honoursYear) %>% 
        tally(name="totalAwards") %>% 
        mutate(cumYear = cumsum(totalAwards)) %>% 
        ungroup() %>% 
        mutate(diffYearOne = totalAwards-first(totalAwards)) %>% 
        mutate(YOYDiff = (totalAwards - lag(totalAwards))/lag(totalAwards))
        
ggplot(awardRate, aes(honoursYear, totalAwards)) +
        geom_line() +
        geom_smooth()

```

Cumulative awards


```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(awardRate, aes(honoursYear, cumYear)) +
        geom_line() 

```

Compared to Year One of the honors system, in 2019 there was a difference of 2066 awards. With the two main honours events already completed in 2020, we can assume that the majority of honours have been awarded already.  This means that 2020 has seen a drop in the numbers of awards issued.

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

ggplot(awardRate, aes(honoursYear, diffYearOne)) +
        geom_line() +
        geom_smooth()

```


Year on Year differences sees a trend line that is generally flat from 2000 onwards, with the 2000+ awards being issued in 2019 giving the trend line a nudge up. 

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(awardRate, aes(honoursYear, YOYDiff)) +
        geom_col() +
        geom_smooth()

```

Focussing though only on the honours issued since the start of 2001, the overall trend of the number of honours being awarded each year is an increase, not a decrease in potentials for a page. 

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
awardRateWPTimeOnly <- allDataAnonRemoved %>% 
        select(honoursYear, honoursDate) %>% 
        filter(!is.na(honoursYear)) %>% 
        filter(honoursDate >= "2001-01-15") %>% 
        group_by(honoursYear) %>% 
        tally(name="totalAwards") %>% 
        mutate(cumYear = cumsum(totalAwards)) %>% 
        ungroup() %>% 
        mutate(diffYearOne = totalAwards-first(totalAwards)) %>% 
        mutate(YOYDiff = (totalAwards - lag(totalAwards))/lag(totalAwards))


ggplot(awardRateWPTimeOnly, aes(honoursYear, totalAwards)) +
        geom_line() +
        geom_smooth()

```

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

ggplot(awardRateWPTimeOnly, aes(honoursYear, cumYear)) +
        geom_line() 

```

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(awardRateWPTimeOnly, aes(honoursYear, diffYearOne)) +
        geom_line() +
        geom_smooth()

```

The difference in the number of awards issued between 2019 and 2020 has pushed the trend line down YOY, but overall, there is still an increase in the nuber of awards.

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(awardRateWPTimeOnly, aes(honoursYear, YOYDiff)) +
  geom_smooth()+      
  geom_col()
        
```

Shows total volume of honours each year, and number of those pages that have a wikipedia page.

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

propPagesOverTime <- allDataAnonRemoved %>% 
        select(honoursYear, honoursDate, wikipediaPage) %>% 
        filter(!is.na(honoursYear)) %>% 
  group_by(honoursYear) %>% 
        add_tally(name = "totalByYear") %>% 
        # filter(honoursDate >= "2001-01-15") %>% 
  group_by(honoursYear, wikipediaPage) %>% 
  add_tally(name = "totalByPage") %>% 
  mutate(yearProp=totalByPage/totalByYear) %>% 
  group_by(honoursYear, wikipediaPage, totalByYear, totalByPage, yearProp) %>% 
  summarise()

ggplot(propPagesOverTime, aes(honoursYear, totalByPage, group=wikipediaPage))+
  # geom_smooth()+
  geom_area(aes(fill=wikipediaPage))
```

Shows proportion of pages that have a wikipedia page.

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

  


ggplot(propPagesOverTime, aes(honoursYear, yearProp, group=wikipediaPage))+
  geom_area(aes(fill=wikipediaPage))

```


Gender Splits over time

All awards over time by gender

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

awardRateGender <- allDataAnonRemoved %>% 
        select(honoursYear, gender) %>% 
  group_by(honoursYear) %>% 
  add_tally(name="total") %>% 
  ungroup() %>% 
    filter(gender!="U") %>% 
        filter(!is.na(honoursYear)) %>% 
        group_by(total, honoursYear, gender) %>% 
        tally(name="totalAwards") %>% 
        mutate(cumYear = cumsum(totalAwards)) %>% 
        ungroup() %>% 
        mutate(diffYearOne = totalAwards-first(totalAwards)) %>% 
        mutate(YOYDiff = (totalAwards - lag(totalAwards))/lag(totalAwards)) %>% 
  mutate(awardProp = totalAwards/total) 


ggplot(awardRateGender, aes(honoursYear, totalAwards, group=gender))+
  geom_area(aes(fill=gender), position="stack")

```

Proportion of awards by gender

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(awardRateGender, aes(honoursYear, awardProp, group=gender))+
  geom_area(aes(fill=gender), position="stack")
```


```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
awardRateGender <- allDataAnonRemoved %>% 
        select(honoursYear, gender, wikipediaPage) %>% 
      filter(!is.na(honoursYear)) %>% 
  filter(gender!="U") %>% 
  group_by(honoursYear) %>% 
  add_tally(name="total") %>% 
  ungroup() %>% 
  group_by(honoursYear, gender) %>% 
  add_tally(name="totalGender") %>% 
  mutate(genderProp=totalGender/total) %>% 
  group_by(honoursYear, gender, wikipediaPage) %>% 
  add_tally(name="totalGenderWPage") %>% 
  mutate(WPProp=totalGenderWPage/totalGender) %>% 
  mutate(awardProp = totalGenderWPage/totalGender) 



```


