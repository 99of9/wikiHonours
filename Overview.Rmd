---
title: "Who do we think we are?"
knit: (function(input_file, encoding) {
  out_dir <- 'docs';
  rmarkdown::render(input_file,
 encoding=encoding,
 output_file=file.path(dirname(input_file), out_dir, 'index.html'))})
author: "Kelly Tall"
date: "15/08/2020"


output: 
        html_document:
                df_print: paged  
                toc: true
                toc_float: true      
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# install.packages("WikidataR")
# install.packages("WikipediR")
# install.packages("tidyverse")
# install.packages("rlist")
# install.packages("WikidataQueryServiceR")


library(lubridate)
library(tidyverse)
library(DataExplorer)
library(plotly)
library(scales)
library(GGally)
library(ggraph)
library(tidygraph)



# all data matched together- all updated as of 8th September

allDataBig <- read_csv("allDataBig.csv") %>% 
        select(-X1) %>% 
        mutate(state = factor(state, levels = c("NSW", "VIC", "QLD", "SA", "TAS", "WA", "ACT", "NT", "Other"))) %>% 
        mutate(awardComb = factor(awardComb, levels = c("ADK", "AC", "AO", "AM", "OAM"))) %>% 
        mutate (honourYear = year(honourDate),
                pageYear = year(pageCreation))


##filtered data ste nly including cases w wikipedia pages plus deleting duplicates
smallData <- allDataBig %>% 
        filter(wikipediaPage=="Yes" & prePost!="No wiki") %>% 
        filter(fullName !="Anonymous") %>% 
        distinct(wikipediaURL, .keep_all = TRUE)



```

## Project Summary and Aims

* Does the Australian honours list follow Wikipedia articles or do Wikipedia articles follow the honours?
* Are there differences in this trend for women?
* Are there differences in this trend for different honours categories/levels?
* Is the rate of article creation for Australian honours winners increasing over time?

## Overview of the Order of Australia

Order of Australia Awards issued since 1975, and has the following levels:

1. Dame of the Order of Australia
2. Knight of the Order of Australia
3. Companion (AC)
4. Officer (AO)
5. Member (AM)
6. Medal (OAM)

More information about the Order of Australia can be found here: https://en.wikipedia.org/wiki/Order_of_Australia.

Awards are issued with the following distinctions:

1. General (G): awarded to Australian Citizens 
2. Military (M): warded to Australian Military
3. Honourary: General and Militrya awards can also be issued to non-citizens as honourary awards. In XXXX a new distinction was created to honour permanent-residents. these used to be issued as HG, but are now issues as HP.

People can receive multiple Order of Australia honours in their lifetime. People can have their awards terminated, or  return or refused their awards.  Some awards are recorded as anonymous.

## Overview of Datasets and their prepararion

There are two main sources for the data:

1. The Australian Honours list that is sourced from the office of PM and Cabinet

2. Wikipedia articles linked to Order of Australia recipients and their creation date

### Australian Honours List

This data set consists of `r nrow(allDataBig)` records, where each record is an Order of Australia honour associated with an individual. 

The data set is sourced from the Office of the Prime Minister and Cabinet. In adddition to this data set there has been a clumn added for gender. At this stage a recipeients gender is limited to Male v Female, although we are aware that there have been trasgender recipeints of the award. Please see detail below on how this variable was constructued, and other relevant information

(ADD IN SECTION BELOW ON HOW ALEX CREATED THIS VARIABLE, PLUS HIS NOTES ON TRANSGENDER RECIPIENTS AND HOW THEY HAVE BEEN RECORDED)



```{r echo=FALSE, message=FALSE, warning=FALSE}


multipleNumber <- allDataBig %>% 
        select(name2) %>% 
        group_by(name2) %>% 
        tally() %>% 
          filter(n>1) %>% 
  nrow()



anonAawrds <- allDataBig %>% 
  filter(fullName!="Anonymous")

multipleRecords <- allDataBig %>% 
  filter(fullName!="Anonymous") %>% 
        select(fullName) %>% 
        group_by(fullName) %>% 
        tally() %>% 
        filter(n>1)

multipleWP <- allDataBig %>% 
        select(wikipediaURL) %>% 
        group_by(wikipediaURL) %>% 
        tally() %>% 
        filter(n>1) %>% 
  nrow()

diff <- multipleNumber - multipleWP

```

The following characteristics of the data set need to be taken into consideration in analysis.

1. Anonymous Awards



2. Multiple Awards

Of the `r nrow(allDataBig)` records, there are a small number of records `r nrow(multipleRecords)` records associated with the same person. 


3. Terminated awards


4. Type of awards (honourary etc)
  


### Wikipedia Data Outline

TO COME

## Analysis

```{r echo=FALSE, message=FALSE, warning=FALSE}
##chart formats

colours <- c("#2d4059", "#ea5455")

custom_theme <-  theme(
                        panel.grid.major.x = element_blank(),
                        panel.background = element_rect(fill=("#e5e5e5")),
                        strip.background = element_blank())



awardSummaryTotal <- allDataBig %>%
        select(awardComb) %>%
        group_by(awardComb) %>%
        tally()

awardSummaryState <- allDataBig %>%
        select(awardComb, state) %>%
        group_by(state, awardComb) %>%
        tally()
#


awardTotal <- ggplot(awardSummaryTotal, aes(awardComb, n)) +
        geom_col(fill="#2d4059") +
        custom_theme+
        labs(title="All Orders of Australia issued (1975 - 2020)",
             x="Order of Australia (membership levels)", y="number of awards", 
             caption="total number of awards n=41,816") +
        scale_fill_manual(values=colours)+
  coord_flip()


ggplotly(awardTotal, tooltip="n")

awardSummaryState <- allDataBig %>%
        group_by(state) %>% 
        add_tally() %>% 
        rename(stateAwardTotal = n) %>% 
        select(awardComb, state, stateAwardTotal) %>%
        mutate(chartLabel = paste(state, " n=",stateAwardTotal, sep="")) %>% 
        group_by(state, awardComb, chartLabel) %>%
        tally() %>% 
        mutate(state = factor(state, levels = c("NSW", "VIC", "QLD", "SA", "TAS", "WA", "ACT", "NT", "Other"))) %>% 
        mutate(chartLabel = as_factor(chartLabel))



awardState <- ggplot(awardSummaryState, aes(reorder(awardComb, n), n))+
        geom_col(fill="#2d4059") +
        facet_wrap(~chartLabel)+
        custom_theme+
        labs(title="Number of award recipients by level of membership by state",
             x="Order of Australia (membership levels)", y="Number of Honours", 
             caption = "'Other' refers to honourary awards, and/or those not residing in Australia, 
             or where there was no location information provided in the record. Total number of honours n=41,816") +
        coord_flip()+
        # geom_text(aes(label=n), hjust=-.3, size=3) +
        scale_y_continuous(limits = c(0, 10100))


ggplotly(awardState, tooltip = "n")




```

```{r echo=FALSE, message=FALSE}

pagePropTotal <- allDataBig %>%
        select(awardComb, wikipediaPage) %>%
        group_by(awardComb, wikipediaPage) %>%
        tally()

pagePropState <- allDataBig %>%
        select(awardComb, wikipediaPage, state) %>%
        group_by(awardComb, wikipediaPage, state) %>%
        tally()



awardWPNum <- ggplot(pagePropTotal, aes(reorder(awardComb, -n), n)) +
  geom_col(aes(fill=wikipediaPage)) +
  custom_theme+
  labs(title="Number of award recipients that have a wikipedia article page",
       x="Order of Australia (membership levels)", y="number of awards") +
  scale_fill_manual(values=colours)



ggplotly(awardWPNum, tooltip = "n")


awardWPNumState <- ggplot(pagePropState, aes(reorder(awardComb, -n), n)) +
  geom_col(aes(fill=wikipediaPage)) +
  facet_wrap(~state)+
  custom_theme+
  labs(title="Number of award recipients that have a wikipedia article page by state",
       x="Order of Australia (membership levels)", y="number of awards")+
  scale_fill_manual(values=colours)



ggplotly(awardWPNumState, tooltip = "n")

awardWPProp <- ggplot(pagePropTotal, aes(reorder(awardComb, -n), n, fill=wikipediaPage)) +
  geom_bar(position="fill", stat="identity") +
  custom_theme+
  labs(title="Proportion of award recipients that have a wikipedia article page",
       x="Order of Australia (membership levels)", y="number of awards") +
  scale_y_continuous(labels = percent)+
  scale_fill_manual(values=colours)


ggplotly(awardWPProp, tooltip="n")

awardWPPropState <- ggplot(pagePropState, aes(reorder(awardComb, n), n, fill=wikipediaPage)) +
        geom_bar(position="fill", stat="identity") +
        facet_wrap(~state)+
        custom_theme+
        labs(title="Proportion of award recipients that have a wikipedia article page by state",
       x="Order of Australia (membership levels)", y="number of awards") +
  scale_y_continuous(labels = percent)+
  scale_fill_manual(values=colours)


ggplotly(awardWPPropState, tooltip="n")




```




```{r echo=FALSE, message=FALSE}
prePost <- allDataBig %>%
  filter(wikipediaPage=="Yes") %>%
  filter(prePost!="No wiki") %>%
  select(prePost) %>%
  group_by(prePost) %>%
  tally()

awardprePost <- ggplot(prePost, aes(prePost, n)) +
  geom_col(fill="#2d4059") +
  custom_theme +
  labs(title="Number of pages created pre / post award",
       y="number of wikiPedia Articles", caption="Pre is calculated as less than zero days before the award was issued. Post is calculated as 0 or greater than days after award issued") +
  scale_fill_manual(values=colours)



ggplotly(awardprePost, tooltip = "n")

timeline <- allDataBig %>%
  filter(wikipediaPage == "Yes") %>%
  select(pageCreation, wikipediaPage) %>%
  group_by(pageCreation, wikipediaPage) %>%
  tally()


timelinePlot <- ggplot(timeline, aes(pageCreation, n)) +
  geom_line() +
  geom_smooth()

ggplotly(timelinePlot, tooltip = "n")

cumulative <- allDataBig %>%
  filter(wikipediaPage == "Yes") %>%
  select(pageCreation, wikipediaPage) %>%
  group_by(pageCreation) %>%
  arrange(pageCreation) %>%
  tally() %>%
  mutate(n= as.numeric(n)) %>%
  mutate(cumulate = cumsum(n))

cumulativePlot <- ggplot(cumulative, aes(pageCreation, cumulate) )+
  geom_line() 

ggplotly(cumulativePlot, tooltip = "cumulate")



prePostGender <- allDataBig %>%
  filter(wikipediaPage=="Yes") %>%
  filter(prePost!="No wiki") %>%
  select(prePost, gender) %>%
  group_by(prePost, gender) %>%
  tally()

awardprePostGender <- ggplot(prePostGender, aes(prePost, n)) +
  geom_col(aes(fill=gender)) +
  custom_theme +
  labs(title="Number of pages created pre / post award",
       y="number of wikiPedia Articles", caption="Pre is calculated as less than zero days before the award was issued. Post is calculated as 0 or greater than days after award issued") +
  scale_fill_manual(values=colours)

ggplotly(awardprePostGender, tooltip = "n")


cumulativeGender <- allDataBig %>%
  filter(wikipediaPage == "Yes") %>%
  select(pageCreation, wikipediaPage, gender) %>%
  group_by(gender, pageCreation) %>%
  arrange(pageCreation) %>%
  tally() %>%
  mutate(n= as.numeric(n)) %>%
  mutate(cumulate = cumsum(n))

cumulativePlotGender <- ggplot(cumulativeGender, aes(pageCreation, cumulate) )+
  geom_line(aes(colour=gender))+
  custom_theme +
  scale_fill_manual(values=colours)

ggplotly(cumulativePlotGender, tooltip = "cumulate")


####  slope chart

slopeData <- smallData %>% 
        select(honourYear, pageYear, prePost, gender, awardComb)

ggparcoord(slopeData, columns = 1:2, groupColumn="prePost", alphaLines = 0.04) 
        
ggparcoord(slopeData, columns = 1:2, groupColumn="prePost", alphaLines = 0.05) +
        facet_wrap(~gender)

ggparcoord(slopeData, columns = 1:2, groupColumn="prePost", alphaLines = 0.05) +
        facet_wrap(~awardComb)



timeData <- smallData %>% 
        filter(wikipediaPage=="Yes" & prePost!="No wiki")  %>% 
        select(daysDiff, gender, awardComb) 

ggplot(timeData, aes(daysDiff)) +
        geom_histogram(binwidth = 500) +
        facet_grid(gender~awardComb) 



ggplot(timeData, aes(daysDiff, after_stat(count), group=gender, fill=gender)) +
        geom_density(alpha=0.5)  +
        facet_grid(~awardComb)

```

### arc plots

```{r echo=FALSE, message=FALSE, fig.width=12}

arcData <- smallData %>% 
        select(honourDate, pageCreation, prePost, gender, awardComb) %>% 
        mutate (from = year(honourDate),
                to = year(pageCreation)) %>% 
        # slice_sample(n = 2) %>% 
        group_by(from, to, gender, awardComb, prePost) %>% 
        tally()  %>% 
        rename(weight=n) %>% 
        na.omit()


arcPlot <- tbl_graph(edges=arcData, directed=TRUE)


ggraph(arcPlot, layout = 'linear') +
        geom_edge_arc(aes(colour=gender), alpha=.3, width=.2) 

ggraph(arcPlot, layout = 'linear') +
        geom_edge_arc(aes(colour=awardComb), alpha=.3, width=.2) 

        

ggraph(arcPlot, layout = 'linear') +
        geom_edge_arc(aes(colour=gender), alpha=.3, width=.2) +
        facet_wrap(~gender)

ggraph(arcPlot, layout = 'linear') +
        geom_edge_arc(aes(colour=gender), alpha=.3, width=.2) +
        facet_grid(~awardComb)


```

