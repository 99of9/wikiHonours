---
title: "Who do we think we are?"
knit: (function(input_file, encoding) {
  out_dir <- 'docs';
  rmarkdown::render(input_file,
 encoding=encoding,
 output_file=file.path(dirname(input_file), out_dir, 'index.html'))})
author: "Kelly Tall"
date: "15/08/2020"


output: 
        html_document:
                df_print: paged  
                toc: true
                toc_float: true      
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# install.packages("WikidataR")
# install.packages("WikipediR")
# install.packages("tidyverse")
# install.packages("rlist")
# install.packages("WikidataQueryServiceR")


library(tidyverse)
library(rlist)
library(ggplot2)
library(plotly)
library(scales)
library(lubridate)








##all data matched together- all updated as of 8th September
allDataBig <- read_csv("allDataBig.csv")




```

## Project Summary and Aims

The two core analysis aims are:

to do: add in text from Heather's outline


## Overview of Dataset Preparation

 **to finish 

Initially data was matched using an extraction from the Australian Honours List, and then matched back to wikiedia and wikipedia (see section below - TO DO - ADD LINK). 

Once initial analysis was done, Alex Lum assisted in providing an extraction of wikipedia pages where an order was stated on the page. This led to the Order information being merged back into the wikidata page. This allowed us to extract further wikipedia pages. No additional pages have been created in wikipedia, but we have been able to get a bettr



### Honours Data Set

The Department of the Prime Minster and Cabinet <a href="https://honours.pmc.gov.au/honours/search">publish a list of Australian Honours recipients</a>. This list includes all recipients of the Order of Australia. 

The records were extracted from this database for all of the Order of Australia Awards issued since 1975, and extracted based on the following award levels:
        
1. Dame of the Order of Australia 
2. Knight of the Order of Australia  
3. Companion (AC) 
4. Officer (AO) 
5. Member (AM) 
6. Medal (OAM) 

More information about the Order of Australia can be found here: https://en.wikipedia.org/wiki/Order_of_Australia.

While the majority of cases are unique, there are some individuals who have been awarded multiple Orders of Australia. In the analysis shown below, all analysis that references the Honours data set, represents the number and type of awards issued. The number of awards in our data set ar XXXXinsert here###. These awards have been given to XXX individuals.
A summary of the number of awards given to indivisuals is as follows

(<em>show summary of number of awards by number of people</em>)


### Matching the honours data set with wikimedia information

<b>expand on  pr0cess here</b>

1. extract data from wikidata, icluding wikidata URL/ID and wikipedia URL
2. get wikipedia page ID for all wikipedia articles
3. use ID to etxract page creation date



## Exploratory analysis

#### Overview of Order of Australia honours
1. How many have been awarded?

2. What is the breakdown by state?

```{r echo=FALSE, message=FALSE, warning=FALSE}
##chart formats

colours <- c("#2d4059", "#ea5455")

custom_theme <-  theme(
                        panel.grid.major.x = element_blank(),
                        panel.background = element_rect(fill=("#e5e5e5")),
                        strip.background = element_blank())



awardSummaryTotal <- allDataBig %>%
        select(awardComb) %>%
        group_by(awardComb) %>%
        tally()

awardSummaryState <- allDataBig %>%
        select(awardComb, state) %>%
        group_by(state, awardComb) %>%
        tally()
# 


awardTotal <-  ggplot(awardSummaryTotal, aes(reorder(awardComb, -n), n))+
  geom_col(fill="#2d4059") +
  custom_theme+
  labs(title="Number of award recipients by level of membership",
       x="Order of Australia (membership levels)", y="number of awards")

ggplotly(awardTotal, tooltip="n")

awardState <- ggplot(awardSummaryState, aes(reorder(awardComb, -n), n))+
  geom_col(fill="#2d4059") +
  facet_wrap(~state)+
  custom_theme+
  labs(title="Number of award recipients by level of membership by state",
       x="Order of Australia (membership levels)", y="number of awards")


ggplotly(awardState, tooltip = "n")


```


#### How many wikipedia pages are there for Order of Australia recipients?

1. What are the proportion Order of Australia recipients who have a wikipedia page?

2. What are the differences by the order level?

3. Are there any differences by recipient state?

```{r echo=FALSE, message=FALSE}

pagePropTotal <- allDataBig %>% 
        select(awardComb, wikipediaPage) %>% 
        group_by(awardComb, wikipediaPage) %>% 
        tally()

pagePropState <- allDataBig %>% 
        select(awardComb, wikipediaPage, state) %>% 
        group_by(awardComb, wikipediaPage, state) %>% 
        tally()



awardWPNum <- ggplot(pagePropTotal, aes(reorder(awardComb, -n), n)) +
  geom_col(aes(fill=wikipediaPage)) +
  custom_theme+
  labs(title="Number of award recipients that have a wikipedia article page", 
       x="Order of Australia (membership levels)", y="number of awards") +
  scale_fill_manual(values=colours)
  
  

ggplotly(awardWPNum, tooltip = "n")


awardWPNumState <- ggplot(pagePropState, aes(reorder(awardComb, -n), n)) +
  geom_col(aes(fill=wikipediaPage)) +
  facet_wrap(~state)+
  custom_theme+
  labs(title="Number of award recipients that have a wikipedia article page by state", 
       x="Order of Australia (membership levels)", y="number of awards")+
  scale_fill_manual(values=colours)

  

ggplotly(awardWPNumState, tooltip = "n")

awardWPProp <- ggplot(pagePropTotal, aes(reorder(awardComb, -n), n, fill=wikipediaPage)) +
  geom_bar(position="fill", stat="identity") +
  custom_theme+
  labs(title="Proportion of award recipients that have a wikipedia article page", 
       x="Order of Australia (membership levels)", y="number of awards") +
  scale_y_continuous(labels = percent)+
  scale_fill_manual(values=colours)
  
        
ggplotly(awardWPProp, tooltip="n")

awardWPPropState <- ggplot(pagePropState, aes(reorder(awardComb, n), n, fill=wikipediaPage)) +
        geom_bar(position="fill", stat="identity") +
        facet_wrap(~state)+
        custom_theme+
        labs(title="Proportion of award recipients that have a wikipedia article page by state", 
       x="Order of Australia (membership levels)", y="number of awards") +
  scale_y_continuous(labels = percent)+
  scale_fill_manual(values=colours)
  

ggplotly(awardWPPropState, tooltip="n")




```

#### What can we learn about the page creation date of those who have a wikipedia page?


1. How many had pages BEFORE or AFTER they received their Order of Australia? Is this different by order level?

2. Does receiving an order result in a spike of wikipedia pages being created?

3. What is the rate of creation of pages? Has there been peaks? Has it slowed at any time?


```{r echo=FALSE, message=FALSE}
prePost <- allDataBig %>%
  filter(wikipediaPage=="Yes") %>% 
  filter(prePost!="No wiki") %>% 
  select(prePost) %>% 
  group_by(prePost) %>% 
  tally()

awardprePost <- ggplot(prePost, aes(prePost, n)) +
  geom_col(fill="#2d4059") +
  custom_theme +
  labs(title="Number of pages created pre / post award", 
       y="number of wikiPedia Articles", caption="Pre is calculated as less than zero days before the award was issued. Post is calculated as 0 or greater than days after award issued") +
  scale_fill_manual(values=colours)
  
  

ggplotly(awardprePost, tooltip = "n")

timeline <- allDataBig %>% 
  filter(wikipediaPage == "Yes") %>% 
  select(pageCreation, wikipediaPage) %>% 
  group_by(pageCreation, wikipediaPage) %>% 
  tally()


timelinePlot <- ggplot(timeline, aes(pageCreation, n)) +
  geom_line()

ggplotly(timelinePlot, tooltip = "n")

cumulative <- allDataBig %>% 
  filter(wikipediaPage == "Yes") %>% 
  select(pageCreation, wikipediaPage) %>% 
  group_by(pageCreation) %>% 
  arrange(pageCreation) %>% 
  tally() %>% 
  mutate(n= as.numeric(n)) %>% 
  mutate(cumulate = cumsum(n))
   
cumulativePlot <- ggplot(cumulative, aes(pageCreation, cumulate) )+
  geom_line()

ggplotly(cumulativePlot, tooltip = "cumulate")



prePostGender <- allDataBig %>%
  filter(wikipediaPage=="Yes") %>% 
  filter(prePost!="No wiki") %>% 
  select(prePost, gender) %>% 
  group_by(prePost, gender) %>% 
  tally()

awardprePostGender <- ggplot(prePostGender, aes(prePost, n)) +
  geom_col(aes(fill=gender)) +
  custom_theme +
  labs(title="Number of pages created pre / post award", 
       y="number of wikiPedia Articles", caption="Pre is calculated as less than zero days before the award was issued. Post is calculated as 0 or greater than days after award issued") +
  scale_fill_manual(values=colours)

ggplotly(awardprePostGender, tooltip = "n")


cumulativeGender <- allDataBig %>% 
  filter(wikipediaPage == "Yes") %>% 
  select(pageCreation, wikipediaPage, gender) %>% 
  group_by(gender, pageCreation) %>% 
  arrange(pageCreation) %>% 
  tally() %>% 
  mutate(n= as.numeric(n)) %>% 
  mutate(cumulate = cumsum(n))
   
cumulativePlotGender <- ggplot(cumulativeGender, aes(pageCreation, cumulate) )+
  geom_line(aes(colour=gender))+
  custom_theme +
  scale_fill_manual(values=colours)

ggplotly(cumulativePlotGender, tooltip = "cumulate")


```





## Random notes
<i> These are just small things I find along the way that may not be that important, but are intersting or that I need to follow up on </i>

* Is there a big proportion of rugby and badmington players who have wikidata entries? (could be good to do some alaysis on this sort of thing / proportion of representation by description in wikiData) 
<br>
* Have gender in data set - checing with Alex on if there is way for broader gender classification
<br>
* How to handle peopel with multiple awards - multiple honour dates to single page creation date
<br>
* Need to find the entry of the nursing accadmic who is referenced in wikipedia page, but has no page of her own / has a wikidata entry (create list of these poeple to have a look and see who they are) (think this is it: https://www.wikidata.org/wiki/Q47193440 - no page but she is refernced here: https://en.wikipedia.org/wiki/Amorality | megan jane JOhnson)
<br> 
* I think I found a few folks that had non eng wikipedia pages (think one was the Producer of shine? - need to check) Is this of interest? Possibly only a v small number. Could scrape the non english pages to see where they have page. (Also - what Australian's in general have been given page in other languages?)
<br> 
* Can I do some "bag of word" analysis on the award description and see if there are any areas that result in more page creations than others? (scientists v politicians v sorts people etc? see point above about representation in decsription of wikidata as well) 
<br>

###Data Limitations

Dataset from PM offce is imcomplete - some award issue dates are missing - ADD NUMBER HERE

Gender - record method that Alex used as per email. 
